// Add to marketplace-contract.js before close() method

  async getProductCount() {
    if (!this.initialized) {
      await this.initialize();
    }

    if (!this.client) {
      throw new Error('MarketplaceContract service not initialized');
    }

    try {
      const query = new ContractCallQuery()
        .setContractId(this.contractId)
        .setGas(100000)
        .setFunction("productCount");

      const result = await query.execute(this.client);
      return result.getUint256(0).toNumber();

    } catch (error) {
      console.error('❌ Error querying product count:', error.message);
      return 0;
    }
  }

  async getProduct(productId) {
    if (!this.initialized) {
      await this.initialize();
    }

    if (!this.client) {
      throw new Error('MarketplaceContract service not initialized');
    }

    try {
      const params = new ContractFunctionParameters()
        .addUint256(productId);

      const query = new ContractCallQuery()
        .setContractId(this.contractId)
        .setGas(100000)
        .setFunction("getProduct", params);

      const result = await query.execute(this.client);
      
      // Parse the Product struct
      return {
        id: result.getUint256(0).toNumber(),
        name: result.getString(1),
        description: result.getString(2),
        category: result.getString(3),
        priceTokens: result.getUint256(4).toNumber(),
        stock: result.getUint256(5).toNumber(),
        imageUrl: result.getString(6),
        isActive: result.getBool(7)
      };

    } catch (error) {
      console.error('❌ Error querying product:', error.message);
      throw error;
    }
  }
